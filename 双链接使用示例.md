# 双链接功能使用示例

## 📋 快速开始

### 1. 调用 text_to_mindmap 工具

```javascript
// 输入参数
{
  "text": "Python 编程基础知识"
}
```

### 2. 获取返回结果

```json
{
  "success": true,
  "downloadUrl": "https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/Python编程基础知识-1729152330123.html?Expires=1886832330&OSSAccessKeyId=xxx&Signature=xxx",
  "previewUrl": "http://page.thingotech.com.cn/page/Python编程基础知识-1729152330123.html",
  "filename": "Python编程基础知识-1729152330123.html",
  "timestamp": "2025-10-17T08:25:30.123Z",
  "message": "思维导图生成并上传成功（OSS + Minio）"
}
```

## 🔗 两个链接的使用场景

### downloadUrl - OSS 下载链接

**特点：**

- ✅ 长期有效（5年）
- ✅ 稳定可靠
- ✅ 带签名验证
- ✅ 适合下载和归档

**使用场景：**

- 长期保存和分享
- 生成永久链接
- 文件下载
- 系统集成接口

**示例：**

```
https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/Python编程基础知识-1729152330123.html?Expires=1886832330&OSSAccessKeyId=xxx&Signature=xxx
```

### previewUrl - Minio 预览链接

**特点：**

- ✅ 简短易记
- ✅ 快速访问
- ✅ 无需签名参数
- ✅ 适合即时预览

**使用场景：**

- 快速分享给他人查看
- 即时预览
- 临时访问
- 用户界面展示

**示例：**

```
http://page.thingotech.com.cn/page/Python编程基础知识-1729152330123.html
```

## 💡 实际应用示例

### 场景 1：在聊天应用中展示

```markdown
**思维导图已生成！**

🔗 快速预览：[点击查看](http://page.thingotech.com.cn/page/Python编程基础知识-1729152330123.html)

📥 下载保存：[下载链接](https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/Python编程基础知识-1729152330123.html?Expires=...)
```

### 场景 2：在网页中嵌入

```html
<!-- 使用预览链接快速展示 -->
<iframe
  src="http://page.thingotech.com.cn/page/Python编程基础知识-1729152330123.html"
  width="100%"
  height="600px"
>
</iframe>

<!-- 提供下载按钮 -->
<a
  href="https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/..."
  download="Python编程基础知识.html"
>
  下载思维导图
</a>
```

### 场景 3：在 API 响应中使用

```javascript
// API 响应
{
  "code": 200,
  "message": "成功",
  "data": {
    "mindmap": {
      "quickView": "http://page.thingotech.com.cn/page/Python编程基础知识-1729152330123.html",
      "download": "https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/...",
      "filename": "Python编程基础知识-1729152330123.html"
    }
  }
}
```

## 🛡️ 容错处理

### Minio 上传失败时

如果 Minio 上传失败，系统会自动降级：

```json
{
  "success": true,
  "downloadUrl": "https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/file.html?...",
  "previewUrl": "https://aiagenttest.oss-cn-beijing.aliyuncs.com/markmap/file.html?...",
  "filename": "file.html",
  "timestamp": "2025-10-17T08:25:30.123Z",
  "message": "思维导图生成并上传成功（仅OSS，Minio上传失败）"
}
```

**注意：** 此时 `previewUrl` 和 `downloadUrl` 相同，都指向 OSS 链接。

### 错误处理示例

```javascript
const response = JSON.parse(result);

if (response.success) {
  // 优先使用预览链接（更简短）
  const viewUrl = response.previewUrl;

  // 同时保存下载链接（长期有效）
  const downloadUrl = response.downloadUrl;

  // 检查是否成功上传到 Minio
  if (response.message.includes("OSS + Minio")) {
    console.log("✅ 双上传成功");
  } else {
    console.log("⚠️ 仅 OSS 上传成功，Minio 上传失败");
  }
} else {
  console.error("❌ 生成失败:", response.message);
}
```

## 📊 对比表格

| 特性     | downloadUrl (OSS)    | previewUrl (Minio) |
| -------- | -------------------- | ------------------ |
| URL 长度 | 很长（带签名）       | 短                 |
| 有效期   | 5年                  | -                  |
| 访问速度 | 正常                 | 快                 |
| 适用场景 | 下载、归档、长期分享 | 预览、即时分享     |
| 稳定性   | 极高                 | 高                 |
| 签名验证 | ✅                   | ❌                 |

## 🎯 最佳实践

1. **即时预览**：使用 `previewUrl`，因为更短更友好
2. **长期保存**：使用 `downloadUrl`，因为有5年有效期
3. **用户界面**：显示 `previewUrl` 作为主要链接，`downloadUrl` 作为下载选项
4. **系统集成**：同时保存两个链接，以便提供多种访问方式

## 🔄 版本兼容性

**v0.2.7 及之前版本：**

```json
{
  "success": true,
  "url": "https://...", // 单一链接
  "filename": "...",
  "timestamp": "...",
  "message": "..."
}
```

**v0.2.8 及之后版本：**

```json
{
  "success": true,
  "downloadUrl": "https://...", // OSS 链接
  "previewUrl": "http://...", // Minio 链接
  "filename": "...",
  "timestamp": "...",
  "message": "..."
}
```

---

**提示**: 如果您正在从旧版本迁移，请将代码中的 `response.url` 改为 `response.downloadUrl` 或 `response.previewUrl`。
